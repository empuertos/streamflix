<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#00FF9D">
    <title>StreamFlix - Movies & TV Shows</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ¬</text></svg>">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #00FF9D;
            --secondary: #1a1a2e;
            --dark: #16213e;
            --light: #f0f0f0;
            --text: #e6e6e6;
            --accent: #ff2e63;
        }

        body {
            background-color: var(--secondary);
            color: var(--text);
            line-height: 1.6;
        }

        header {
            background: linear-gradient(to right, var(--dark), var(--secondary));
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            color: var(--primary);
            font-size: 2rem;
        }

        .logo h1 {
            font-size: 1.8rem;
            background: linear-gradient(to right, var(--primary), #00cc7a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .search-container {
            display: flex;
            gap: 10px;
            position: relative;
        }

        .search-suggestions {
            animation: fadeIn 0.2s ease-in;
        }

        .live-search-results {
            animation: fadeIn 0.2s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .search-suggestion {
            padding: 12px 20px;
            cursor: pointer;
            color: var(--text);
            border-bottom: 1px solid rgba(0,255,157,0.2);
            transition: background-color 0.2s;
            font-size: 0.9rem;
        }

        .search-suggestion:hover {
            background-color: rgba(0,255,157,0.1);
        }

        .search-suggestion mark {
            background-color: var(--primary);
            color: var(--secondary);
            padding: 2px 4px;
            border-radius: 3px;
        }

        .search-suggestion i {
            margin-right: 10px;
            color: var(--primary);
            width: 16px;
        }

        .live-results-header {
            background: rgba(0,255,157,0.1);
        }

        .live-result-card {
            border: 1px solid rgba(0,255,157,0.1);
        }

        .live-result-card:hover {
            background: rgba(0,255,157,0.1);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .live-result-info h4 mark {
            background-color: var(--primary);
            color: var(--secondary);
            padding: 1px 3px;
            border-radius: 2px;
        }

        .live-result-info p mark {
            background-color: rgba(0,255,157,0.3);
            color: var(--text);
            padding: 1px 2px;
            border-radius: 2px;
        }

        .no-live-results {
            background: rgba(255,46,99,0.1);
            border: 1px solid var(--accent);
            border-radius: 10px;
            margin: 15px;
        }

        .search-loading {
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Mobile responsiveness for live search */
        @media (max-width: 768px) {
            .live-search-results {
                position: fixed;
                top: auto;
                left: 10px;
                right: 10px;
                border-radius: 15px;
                z-index: 1001;
                max-height: 400px;
            }

            .live-results-grid {
                grid-template-columns: 1fr !important;
                gap: 10px !important;
                padding: 10px !important;
            }

            .live-result-card {
                padding: 8px !important;
            }

            .live-result-poster img {
                width: 50px !important;
                height: 75px !important;
            }
        }

        .search-box {
            padding: 0.7rem 1rem;
            border-radius: 30px;
            border: 2px solid var(--dark);
            background-color: var(--dark);
            color: var(--text);
            width: 300px;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--primary);
            width: 350px;
        }

        .search-btn {
            background-color: var(--primary);
            color: var(--secondary);
            border: none;
            border-radius: 30px;
            padding: 0.7rem 1.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .search-btn:hover {
            background-color: #00cc7a;
            transform: translateY(-2px);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .hero {
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)),
                        url('https://image.tmdb.org/t/p/original/8rpDcsfLJypbO6vREc0547VKqEv.jpg');
            background-size: cover;
            background-position: center;
            height: 70vh;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 3rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
            background-attachment: fixed;
        }

        @media (max-width: 768px) {
            .hero {
                background-attachment: scroll;
            }
        }

        .hero-content {
            max-width: 600px;
            z-index: 2;
        }

        .hero h2 {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(to right, var(--primary), #fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            color: var(--light);
        }

        .hero-btns {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.8rem 1.8rem;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            font-size: 1rem;
        }

        .btn-primary {
            background-color: var(--primary);
            color: var(--secondary);
        }

        .btn-primary:hover {
            background-color: #00cc7a;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 255, 157, 0.3);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--text);
            border: 2px solid var(--text);
        }

        .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
        }

        .section-title {
            font-size: 1.8rem;
            margin: 2rem 0 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: var(--primary);
        }

        .mode-toggle {
            display: flex;
            background-color: var(--dark);
            border-radius: 30px;
            padding: 5px;
            margin-bottom: 2rem;
            width: fit-content;
        }

        .mode-btn {
            padding: 0.7rem 1.5rem;
            border-radius: 30px;
            border: none;
            background: transparent;
            color: var(--text);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background-color: var(--primary);
            color: var(--secondary);
        }

        .main-content {
            display: flex;
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
            flex: 1;
        }

        .categories-sidebar {
            width: 280px;
            background: var(--dark);
            border-radius: 15px;
            padding: 1.5rem;
            height: fit-content;
            position: sticky;
            top: 100px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .categories-header {
            border-bottom: 2px solid var(--primary);
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }

        .categories-header h3 {
            color: var(--primary);
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .categories-section {
            margin-bottom: 2rem;
        }

        .categories-section h4 {
            color: var(--text);
            font-size: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0.5rem;
            background: rgba(0, 255, 157, 0.1);
            border-radius: 8px;
        }

        .categories-section h4 i {
            color: var(--primary);
        }

        .category-list {
            display: grid;
            gap: 0.5rem;
        }

        .category-item {
            padding: 0.7rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text);
            font-size: 0.9rem;
            border-left: 3px solid transparent;
        }

        .category-item:hover {
            background: rgba(0, 255, 157, 0.1);
            border-left-color: var(--primary);
            transform: translateX(5px);
        }

        .category-item.active {
            background: rgba(0, 255, 157, 0.2);
            border-left-color: var(--primary);
            color: var(--primary);
        }

        .year-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
        }

        .year-item {
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 0.85rem;
            color: var(--text);
        }

        .year-item:hover {
            background: rgba(0, 255, 157, 0.1);
            color: var(--primary);
        }

        .trending-list {
            display: grid;
            gap: 0.5rem;
        }

        .trending-item {
            padding: 0.7rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .trending-item:hover {
            background: rgba(255, 46, 99, 0.1);
            color: var(--accent);
        }

        .trending-badge {
            font-size: 1.2rem;
        }

        .category-count, .year-count {
            background: var(--primary);
            color: var(--secondary);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: auto;
        }

        /* Mobile responsiveness for categories sidebar */
        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
            }

            .categories-sidebar {
                width: 100%;
                position: static;
                margin-bottom: 2rem;
            }

            .categories-section {
                margin-bottom: 1.5rem;
            }

            .year-list {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 768px) {
            .year-list {
                grid-template-columns: repeat(3, 1fr);
            }

            .category-list {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.3rem;
            }

            .category-item {
                padding: 0.5rem;
                font-size: 0.8rem;
            }
        }

        .content-card {
            background-color: var(--dark);
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            height: 300px;
            display: flex;
            flex-direction: column;
        }

        .content-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }

        .card-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            flex: 1;
        }

        .card-content {
            padding: 1rem;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.9), transparent);
            color: white;
            margin-top: auto;
        }

        .card-title {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: white;
        }

        .card-info {
            display: flex;
            justify-content: space-between;
            color: #fff;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .card-rating {
            color: gold;
        }

        .year-badge, .rating-badge, .type-badge {
            background: rgba(0,255,157,0.15);
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .rating-badge {
            color: #ffd700;
        }

        .year-badge {
            color: #4CAF50;
        }

        .type-badge {
            color: #2196F3;
        }

        .card-overview {
            font-size: 0.85rem;
            color: #ccc;
            line-height: 1.4;
            margin-bottom: 12px;
        }

        .cast-info {
            margin-top: 8px;
            padding: 8px 0;
            border-top: 1px solid rgba(0,255,157,0.1);
        }

        .director-info {
            margin-bottom: 8px;
        }

        .cast-members {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .cast-member {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(0,255,157,0.05);
            padding: 3px 6px;
            border-radius: 12px;
            transition: all 0.3s;
        }

        .cast-member:hover {
            background: rgba(0,255,157,0.1);
            transform: translateY(-1px);
        }

        .cast-member img {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            object-fit: cover;
            border: 1px solid var(--primary);
        }

        .cast-loading {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #999;
            font-size: 0.75rem;
        }

        .cast-crew-info {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(0, 255, 157, 0.2);
        }

        .director-section h3, .cast-section h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        .director-card {
            transition: transform 0.3s;
        }

        .director-card:hover {
            transform: translateY(-2px);
        }

        .cast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .cast-card {
            transition: all 0.3s;
            cursor: pointer;
        }

        .cast-card:hover {
            background: rgba(0, 255, 157, 0.1);
            transform: translateY(-2px);
        }

        .cast-card img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 1px solid var(--primary);
            flex-shrink: 0;
        }

        .cast-card h5 {
            font-size: 0.9rem;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .cast-card p {
            font-size: 0.8rem;
            color: #999;
        }

        .card-title mark {
            background-color: var(--primary);
            color: var(--secondary);
            padding: 1px 3px;
            border-radius: 2px;
        }

        .card-overview mark {
            background-color: rgba(0,255,157,0.3);
            color: var(--text);
            padding: 1px 2px;
            border-radius: 2px;
        }

        .watch-btn-card {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .watch-btn-card:hover {
            background-color: #ff1a4f;
            transform: translateY(-2px);
        }

        .loading {
            text-align: center;
            padding: 2rem;
            display: none;
        }

        .loading-spinner {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 5px solid var(--primary);
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            overflow: visible;
            padding: 0;
        }

        .modal-content {
            background: linear-gradient(to bottom right, var(--dark), var(--secondary));
            width: 100%;
            height: 100%;
            margin: 0;
            border-radius: 0;
            overflow-y: auto;
            box-shadow: none;
        }

        .modal-header {
            padding: 1.5rem;
            background-color: rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: var(--accent);
        }

        .modal-body {
            padding: 1.5rem;
            display: flex;
            gap: 1.5rem;
        }

        .modal-poster {
            flex-shrink: 0;
            width: 300px;
            height: auto;
            border-radius: 10px;
        }

        .modal-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .modal-info h3 {
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .modal-overview {
            line-height: 1.7;
        }

        .watch-btn {
            background-color: var(--accent);
            color: white;
            padding: 1rem 2rem;
            border-radius: 30px;
            border: none;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            margin-top: 2rem;
        }

        .watch-btn:hover {
            background-color: #ff1a4f;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 46, 99, 0.4);
        }

        .trailer-btn {
            background-color: var(--primary);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 30px;
            border: none;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            margin-top: 1rem;
        }

        .trailer-btn:hover {
            background-color: #00cc7a;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 255, 157, 0.3);
        }

        /* Trailer Modal Styles */
        .trailer-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }

        .trailer-modal-content {
            background-color: var(--dark);
            width: 90%;
            max-width: 800px;
            height: 60%;
            max-height: 450px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .trailer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background-color: rgba(0, 0, 0, 0.7);
            border-bottom: 1px solid var(--primary);
        }

        .trailer-title {
            color: var(--primary);
            font-size: 1.2rem;
            font-weight: 600;
        }

        .close-trailer {
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-trailer:hover {
            color: var(--accent);
        }

        .trailer-video {
            width: 100%;
            height: calc(100% - 60px);
            border: none;
        }

        /* Mobile optimizations for trailer modal */
        @media (max-width: 768px) {
            .trailer-modal-content {
                width: 95%;
                height: 50%;
                max-height: 350px;
            }

            .trailer-header {
                padding: 0.5rem;
            }

            .trailer-title {
                font-size: 1rem;
            }
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 1rem;
            }

            .search-container {
                width: 100%;
                position: relative;
            }

            .search-box {
                width: 100%;
                font-size: 1rem;
            }

            .search-suggestions {
                position: fixed;
                top: auto;
                left: 10px;
                right: 10px;
                border-radius: 10px;
                z-index: 1001;
                max-height: 200px;
            }

            .search-loading {
                right: 80px;
                font-size: 12px;
            }

            .hero {
                height: 50vh;
                padding: 2rem;
            }

            .hero h2 {
                font-size: 2rem;
            }

            .content-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 1rem;
            }

            .content-card {
                height: 250px;
                flex-direction: column;
            }

            .modal-body {
                flex-direction: column;
                padding: 1rem;
            }
            .modal-header {
                padding: 1rem;
            }
            .modal-poster {
                width: 100%;
                max-width: 250px;
                align-self: center;
            }
        }

        @media (max-width: 480px) {
            .hero h2 {
                font-size: 1.5rem;
            }

            .hero p {
                font-size: 1rem;
            }

            .content-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 0.8rem;
            }

            .content-card {
                height: 200px;
                flex-direction: column;
            }

            .card-title {
                font-size: 0.9rem;
            }

            .card-info {
                font-size: 0.8rem;
            }

            .cast-members {
                flex-direction: column;
                align-items: flex-start;
                gap: 3px;
            }

            .cast-member {
                justify-content: flex-start;
            }

            .cast-member img {
                width: 20px;
                height: 20px;
            }

            .cast-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .cast-card {
                padding: 8px;
            }

            .cast-card img {
                width: 45px;
                height: 45px;
            }

            .director-card {
                padding: 10px;
            }

            .director-card img {
                width: 60px;
                height: 60px;
            }
        }

        footer {
            background-color: var(--dark);
            padding: 3rem 2rem;
            margin-top: 3rem;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .footer-section h3 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
        }

        .social-links {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: var(--text);
            transition: all 0.3s;
        }

        .social-links a:hover {
            background-color: var(--primary);
            color: var(--secondary);
            transform: translateY(-3px);
        }

        .copyright {
            text-align: center;
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #aaa;
        }

        /* Video Modal Styles */
        .video-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 2000;
        }

        .video-modal-content {
            background-color: var(--dark);
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .video-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background-color: rgba(0, 0, 0, 0.7);
            border-bottom: 1px solid var(--primary);
        }

        .video-title {
            color: var(--primary);
            font-size: 1.2rem;
            font-weight: 600;
        }

        .provider-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .provider-btn-small {
            background-color: var(--secondary);
            color: var(--text);
            border: 1px solid var(--primary);
            padding: 0.3rem 0.6rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }

        .provider-btn-small:hover {
            background-color: var(--primary);
            color: var(--secondary);
        }

        .provider-btn-small.active {
            background-color: var(--primary);
            color: var(--secondary);
            box-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
        }

        .video-quality {
            color: var(--primary);
            font-weight: bold;
            font-size: 0.9rem;
        }

        .close-video {
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-video:hover {
            color: var(--accent);
        }

        .video-player {
            flex: 1;
            position: relative;
            background-color: black;
            cursor: pointer;
        }

        .video-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--primary);
            font-size: 1.2rem;
            z-index: 10;
        }

        .video-loading i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .stream-iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
        }

        /* Custom Player Controls */
        .player-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
            padding: 1rem;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 15;
        }

        .video-player:hover .player-controls {
            opacity: 1;
        }

        .controls-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .controls-bottom {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .play-pause-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: background 0.3s;
        }

        .play-pause-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .progress-container {
            flex: 1;
            position: relative;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            cursor: pointer;
            margin: 0 1rem;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary);
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s;
        }

        .time-display {
            color: white;
            font-size: 0.9rem;
            min-width: 80px;
            text-align: center;
        }

        .volume-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .volume-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .volume-slider {
            width: 80px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }

        .volume-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 2px;
            width: 70%;
        }

        .fullscreen-btn, .pip-btn, .next-episode-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.5rem;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .fullscreen-btn:hover, .pip-btn:hover, .next-episode-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .next-episode-btn {
            display: none;
        }

        .tv-mode .next-episode-btn {
            display: block;
        }

        /* Mobile optimizations for video modal */
        @media (max-width: 768px) {
            .video-header {
                flex-direction: column;
                gap: 1rem;
                padding: 0.5rem;
            }

            .provider-buttons {
                flex-wrap: wrap;
                justify-content: center;
            }

            .provider-btn-small {
                font-size: 0.7rem;
                padding: 0.2rem 0.4rem;
            }
        }
    </style>
</head>
<body>
    <div id="root">
    <header>
        <nav class="navbar">
            <div class="logo">
                <h1><i class="fas fa-play-circle"></i> StreamFlix</h1>
            </div>
            <div class="search-container">
                <input type="text" class="search-box" id="searchInput" placeholder="ðŸ” Search movies, TV shows, actors, genres...">
                <button class="search-btn" id="searchBtn"><i class="fas fa-search"></i> Search</button>
            </div>
        </nav>
    </header>

    <div class="container">
        <section class="hero">
            <div class="hero-content">
                <h2 id="heroTitle">Unlimited Entertainment</h2>
                <p id="heroDesc">Stream thousands of movies and TV shows in HD quality. Anytime, anywhere.</p>
                <div class="hero-btns">
                    <button class="btn btn-primary" id="startWatchingBtn"><i class="fas fa-play"></i> Start Watching</button>
                    <button class="btn btn-secondary" id="moreInfoBtn"><i class="fas fa-info-circle"></i> More Info</button>
                </div>
            </div>
        </section>

        <div class="mode-toggle">
            <button class="mode-btn active" id="movieMode">Movies</button>
            <button class="mode-btn" id="tvMode">TV Shows</button>
        </div>

        <h2 class="section-title"><i class="fas fa-fire"></i> Popular Now</h2>
        <div class="main-content">
            <div class="content-grid" id="contentGrid">
                <!-- Content will be loaded here -->
            </div>

            <!-- Categories Sidebar -->
            <div class="categories-sidebar">
                <div class="categories-header">
                    <h3><i class="fas fa-th-large"></i> Categories</h3>
                </div>

                <div class="categories-section">
                    <h4><i class="fas fa-film"></i> Movie Genres</h4>
                    <div class="category-list" id="movieCategories">
                        <div class="category-item loading">
                            <i class="fas fa-spinner fa-spin"></i> Loading...
                        </div>
                    </div>
                </div>

                <div class="categories-section">
                    <h4><i class="fas fa-tv"></i> TV Show Genres</h4>
                    <div class="category-list" id="tvCategories">
                        <div class="category-item loading">
                            <i class="fas fa-spinner fa-spin"></i> Loading...
                        </div>
                    </div>
                </div>

                <div class="categories-section">
                    <h4><i class="fas fa-calendar"></i> Browse by Year</h4>
                    <div class="year-list" id="yearCategories">
                        <!-- Years will be populated dynamically -->
                    </div>
                </div>

                <div class="categories-section">
                    <h4><i class="fas fa-fire"></i> Popular Now</h4>
                    <div class="trending-list" id="trendingCategories">
                        <div class="trending-item">
                            <span class="trending-badge">ðŸ”¥</span>
                            <span>Action Movies</span>
                        </div>
                        <div class="trending-item">
                            <span class="trending-badge">ðŸ“º</span>
                            <span>TV Series</span>
                        </div>
                        <div class="trending-item">
                            <span class="trending-badge">ðŸ˜‚</span>
                            <span>Comedy</span>
                        </div>
                        <div class="trending-item">
                            <span class="trending-badge">ðŸ˜±</span>
                            <span>Horror</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p>Loading content...</p>
        </div>

        <button class="btn btn-secondary" id="loadMore" style="display: none; margin: 0 auto;">Load More</button>
    </div>

    <!-- Detail Modal -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Movie Title</h2>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div>
                    <img src="" alt="Poster" class="modal-poster" id="modalPoster">
                </div>
                <div class="modal-details">
                    <div class="modal-info">
                        <h3>Details</h3>
                        <p><strong>Release Date:</strong> <span id="modalDate"></span></p>
                        <p><strong>Rating:</strong> <span id="modalRating"></span></p>
                        <p><strong>Language:</strong> <span id="modalLanguage"></span></p>
                        <p><strong>Runtime:</strong> <span id="modalRuntime"></span></p>
                        <p><strong>Genres:</strong> <span id="modalGenres"></span></p>
                        <p><strong>Director:</strong> <span id="modalDirector"></span></p>
                    </div>
                    <div class="modal-overview">
                        <h3>Overview</h3>
                        <p id="modalOverview">No overview available.</p>
                        <button class="watch-btn" id="watchBtn"><i class="fas fa-play"></i> Watch Now</button>
                        <button class="trailer-btn" id="trailerBtn" style="display: none;"><i class="fas fa-film"></i> Watch Trailer</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    </div>

    <!-- Trailer Modal -->
    <div class="trailer-modal" id="trailerModal">
        <div class="trailer-modal-content">
            <div class="trailer-header">
                <h3 class="trailer-title" id="trailerTitle">Trailer</h3>
                <button class="close-trailer" id="closeTrailer">&times;</button>
            </div>
            <iframe class="trailer-video" id="trailerVideo" src="" allowfullscreen></iframe>
        </div>
    </div>

    <script>
        // Configuration
        const IMG_URL = 'https://image.tmdb.org/t/p/w500';
        const API_URL = 'https://streamflix.22afed28-f0b2-46d0-8804-c90e25c90bd4.workers.dev';

        // State variables
        let currentPage = 1;
        let currentQuery = '';
        let isFetching = false;
        let currentMode = 'movie';
        let currentItem = null;
        let heroMovies = [];
        let currentHeroIndex = 0;

        // DOM Elements
        const contentGrid = document.getElementById('contentGrid');
        const loadingElement = document.getElementById('loading');
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const movieModeBtn = document.getElementById('movieMode');
        const tvModeBtn = document.getElementById('tvMode');
        const loadMoreBtn = document.getElementById('loadMore');
        const detailModal = document.getElementById('detailModal');
        const closeModal = document.getElementById('closeModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalPoster = document.getElementById('modalPoster');
        const modalDate = document.getElementById('modalDate');
        const modalRating = document.getElementById('modalRating');
        const modalLanguage = document.getElementById('modalLanguage');
        const modalRuntime = document.getElementById('modalRuntime');
        const modalGenres = document.getElementById('modalGenres');
        const modalDirector = document.getElementById('modalDirector');
        const modalOverview = document.getElementById('modalOverview');
        const watchBtn = document.getElementById('watchBtn');
        const trailerBtn = document.getElementById('trailerBtn');
        const closeTrailer = document.getElementById('closeTrailer');
        const trailerModal = document.getElementById('trailerModal');
        const trailerVideo = document.getElementById('trailerVideo');
        const trailerTitle = document.getElementById('trailerTitle');
        const startWatchingBtn = document.getElementById('startWatchingBtn');
        const moreInfoBtn = document.getElementById('moreInfoBtn');

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            fetchContent();
            fetchHeroMovies();
            setupEventListeners();
            addSearchEnhancements();
            loadCategories();
            // Set interval to refetch hero movies every 5 minutes
            setInterval(fetchHeroMovies, 5 * 60 * 1000);

            // Add debugging for cast/crew loading
            console.log('StreamFlix initialized with cast/crew support');

            // Add a function to refresh all cast information
            window.refreshAllCastInfo = refreshAllCastInfo;

            // Add console commands for debugging
            window.debugCast = {
                refreshAll: refreshAllCastInfo,
                testData: () => console.log('Test cast data:', window.testCastData),
                checkAPI: () => console.log('API URL:', API_URL)
            };

            console.log('Debug commands available: debugCast.refreshAll(), debugCast.testData(), debugCast.checkAPI()');
        });

        // Function to refresh all cast information for visible cards
        function refreshAllCastInfo() {
            console.log('Refreshing all cast information...');
            const castContainers = document.querySelectorAll('[id^="cast-"]');

            castContainers.forEach(container => {
                const itemId = container.id.replace('cast-', '');
                const cards = document.querySelectorAll('.content-card');

                cards.forEach(card => {
                    const watchBtn = card.querySelector('.watch-btn-card');
                    if (watchBtn && watchBtn.getAttribute('data-item-id') == itemId) {
                        const item = {
                            id: parseInt(itemId),
                            type: card.querySelector('.type-badge')?.textContent === 'TV Show' ? 'tv' : 'movie'
                        };

                        if (item.id && item.type) {
                            console.log('Refreshing cast for item:', item);
                            // Reset the container
                            container.innerHTML = `
                                <div class="cast-loading" style="display: flex; align-items: center; gap: 8px; color: #999; font-size: 0.75rem;">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    <span>Loading cast & crew...</span>
                                </div>
                            `;
                            // Reload cast info
                            loadCastInfo(item.id, item.type);
                        }
                    }
                });
            });
        }

        // Load and populate categories
        async function loadCategories() {
            try {
                console.log('Loading categories...');
                const [movieResponse, tvResponse] = await Promise.all([
                    fetch(`${API_URL}/movie/popular?page=1`),
                    fetch(`${API_URL}/tv/popular?page=1`)
                ]);

                const [movieData, tvData] = await Promise.all([
                    movieResponse.json(),
                    tvResponse.json()
                ]);

                console.log('Categories data loaded:', {
                    movies: movieData.results.length,
                    tvShows: tvData.results.length
                });

                populateMovieCategories(movieData.results);
                populateTVCategories(tvData.results);
                populateYearCategories([...movieData.results, ...tvData.results]);

                // Attach event listeners after categories are populated
                setTimeout(() => {
                    attachCategoryEventListeners();
                }, 500);

                console.log('Categories populated successfully');

            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        function populateMovieCategories(movies) {
            const container = document.getElementById('movieCategories');
            if (!container) return;

            // Get unique genres from movies
            const genres = new Map();

            movies.forEach(movie => {
                if (movie.genre_ids && movie.genre_ids.length > 0) {
                    movie.genre_ids.forEach(genreId => {
                        if (!genres.has(genreId)) {
                            genres.set(genreId, { id: genreId, count: 0, movies: [] });
                        }
                        genres.get(genreId).count++;
                        genres.get(genreId).movies.push(movie);
                    });
                }
            });

            // Convert genre IDs to names (common movie genres)
            const genreNames = {
                28: 'Action', 12: 'Adventure', 16: 'Animation', 35: 'Comedy',
                80: 'Crime', 99: 'Documentary', 18: 'Drama', 10751: 'Family',
                14: 'Fantasy', 36: 'History', 27: 'Horror', 10402: 'Music',
                9648: 'Mystery', 10749: 'Romance', 878: 'Science Fiction',
                10770: 'TV Movie', 53: 'Thriller', 10752: 'War', 37: 'Western'
            };

            container.innerHTML = '';

            Array.from(genres.entries())
                .sort((a, b) => b[1].count - a[1].count)
                .slice(0, 12) // Show top 12 genres
                .forEach(([genreId, data]) => {
                    const genreName = genreNames[genreId] || `Genre ${genreId}`;
                    const categoryItem = document.createElement('div');
                    categoryItem.className = 'category-item';
                    categoryItem.setAttribute('data-genre-id', genreId);
                    categoryItem.setAttribute('data-genre-type', 'movie');
                    categoryItem.innerHTML = `
                        <span>${genreName}</span>
                        <span class="category-count">${data.count}</span>
                    `;

                    // Add click event listener with proper context
                    categoryItem.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const clickedGenreId = this.getAttribute('data-genre-id');
                        const clickedType = this.getAttribute('data-genre-type');
                        console.log('Movie category clicked:', genreName, 'ID:', clickedGenreId);
                        filterByGenre(parseInt(clickedGenreId), clickedType);
                    });

                    container.appendChild(categoryItem);
                });
        }

        function populateTVCategories(tvShows) {
            const container = document.getElementById('tvCategories');
            if (!container) return;

            // Get unique genres from TV shows
            const genres = new Map();

            tvShows.forEach(show => {
                if (show.genre_ids && show.genre_ids.length > 0) {
                    show.genre_ids.forEach(genreId => {
                        if (!genres.has(genreId)) {
                            genres.set(genreId, { id: genreId, count: 0, shows: [] });
                        }
                        genres.get(genreId).count++;
                        genres.get(genreId).shows.push(show);
                    });
                }
            });

            // Convert genre IDs to names (common TV genres)
            const genreNames = {
                10759: 'Action & Adventure', 16: 'Animation', 35: 'Comedy',
                80: 'Crime', 99: 'Documentary', 18: 'Drama', 10751: 'Family',
                10762: 'Kids', 9648: 'Mystery', 10763: 'News', 10764: 'Reality',
                10765: 'Sci-Fi & Fantasy', 10766: 'Soap', 10767: 'Talk',
                10768: 'War & Politics', 37: 'Western'
            };

            container.innerHTML = '';

            Array.from(genres.entries())
                .sort((a, b) => b[1].count - a[1].count)
                .slice(0, 12) // Show top 12 genres
                .forEach(([genreId, data]) => {
                    const genreName = genreNames[genreId] || `Genre ${genreId}`;
                    const categoryItem = document.createElement('div');
                    categoryItem.className = 'category-item';
                    categoryItem.setAttribute('data-genre-id', genreId);
                    categoryItem.setAttribute('data-genre-type', 'tv');
                    categoryItem.innerHTML = `
                        <span>${genreName}</span>
                        <span class="category-count">${data.count}</span>
                    `;

                    // Add click event listener with proper context
                    categoryItem.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const clickedGenreId = this.getAttribute('data-genre-id');
                        const clickedType = this.getAttribute('data-genre-type');
                        console.log('TV category clicked:', genreName, 'ID:', clickedGenreId);
                        filterByGenre(parseInt(clickedGenreId), clickedType);
                    });

                    container.appendChild(categoryItem);
                });
        }

        function populateYearCategories(items) {
            const container = document.getElementById('yearCategories');
            if (!container) return;

            // Get unique years
            const years = new Map();

            items.forEach(item => {
                const date = item.release_date || item.first_air_date;
                if (date) {
                    const year = new Date(date).getFullYear().toString();
                    if (!years.has(year)) {
                        years.set(year, 0);
                    }
                    years.set(year, years.get(year) + 1);
                }
            });

            container.innerHTML = '';

            Array.from(years.entries())
                .sort((a, b) => b[0] - a[0]) // Sort by year descending
                .slice(0, 15) // Show last 15 years
                .forEach(([year, count]) => {
                    const yearItem = document.createElement('div');
                    yearItem.className = 'year-item';
                    yearItem.setAttribute('data-year', year);
                    yearItem.innerHTML = `
                        <span>${year}</span>
                        <span class="year-count">${count}</span>
                    `;

                    // Add click event listener with proper context
                    yearItem.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const clickedYear = this.getAttribute('data-year');
                        console.log('Year clicked:', clickedYear);
                        filterByYear(clickedYear);
                    });

                    container.appendChild(yearItem);
                });
        }

        function filterByGenre(genreId, type) {
            console.log('Filtering by genre:', genreId, 'Type:', type);

            // Remove active class from all categories
            document.querySelectorAll('.category-item').forEach(item => {
                item.classList.remove('active');
            });

            // Add active class to clicked category
            if (event && event.target) {
                const clickedItem = event.target.closest('.category-item');
                if (clickedItem) {
                    clickedItem.classList.add('active');
                }
            }

            // Filter content by genre
            performGenreFilter(genreId, type);
        }

        function filterByYear(year) {
            console.log('Filtering by year:', year);

            // Remove active class from all years
            document.querySelectorAll('.year-item').forEach(item => {
                item.classList.remove('active');
            });

            // Add active class to clicked year
            if (event && event.target) {
                const clickedItem = event.target.closest('.year-item');
                if (clickedItem) {
                    clickedItem.classList.add('active');
                }
            }

            // Filter content by year
            performYearFilter(year);
        }

        async function performGenreFilter(genreId, type) {
            try {
                console.log('Performing genre filter:', { genreId, type });
                showSearchLoading(true);

                let endpoint;
                if (type === 'movie') {
                    endpoint = `${API_URL}/discover/movie?with_genres=${genreId}&page=1`;
                } else {
                    endpoint = `${API_URL}/discover/tv?with_genres=${genreId}&page=1`;
                }

                console.log('Genre filter endpoint:', endpoint);
                const response = await fetch(endpoint);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('Genre filter results:', data.results.length);

                displayContent(data.results);
                updateSearchResultsCounter(data.results.length);
                showSearchLoading(false);

            } catch (error) {
                console.error('Error filtering by genre:', error);
                showSearchLoading(false);
                alert('Error filtering by genre. Please try again.');
            }
        }

        async function performYearFilter(year) {
            try {
                showSearchLoading(true);

                const [movieResponse, tvResponse] = await Promise.all([
                    fetch(`${API_URL}/discover/movie?primary_release_year=${year}&page=1`),
                    fetch(`${API_URL}/discover/tv?first_air_date.gte=${year}-01-01&first_air_date.lte=${year}-12-31&page=1`)
                ]);

                const [movieData, tvData] = await Promise.all([
                    movieResponse.json(),
                    tvResponse.json()
                ]);

                const combinedResults = [...movieData.results, ...tvData.results];
                displayContent(combinedResults);
                updateSearchResultsCounter(combinedResults.length);
                showSearchLoading(false);

            } catch (error) {
                console.error('Error filtering by year:', error);
                showSearchLoading(false);
            }
        }

        function addSearchEnhancements() {
            // Add search hint
            const searchContainer = document.querySelector('.search-container');
            const hint = document.createElement('small');
            hint.textContent = 'ðŸ’¡ Tip: Try searching for movie titles, actors, or genres!';
            hint.style.cssText = `
                display: block;
                color: rgba(255,255,255,0.6);
                font-size: 0.8rem;
                margin-top: 8px;
                text-align: center;
            `;
            searchContainer.appendChild(hint);

            // Add refresh cast info button (hidden by default, can be enabled for debugging)
            const refreshBtn = document.createElement('button');
            refreshBtn.innerHTML = '<i class="fas fa-sync"></i> Refresh Cast Info';
            refreshBtn.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: var(--primary);
                color: var(--secondary);
                border: none;
                padding: 10px 15px;
                border-radius: 25px;
                cursor: pointer;
                font-size: 0.8rem;
                z-index: 1000;
                display: none; /* Hidden by default, can be enabled for debugging */
                box-shadow: 0 4px 15px rgba(0,255,157,0.3);
            `;
            refreshBtn.onclick = refreshAllCastInfo;
            document.body.appendChild(refreshBtn);

            // Add keyboard shortcut hint for search focus
            document.addEventListener('keydown', (e) => {
                if (e.key === '/' && !e.ctrlKey && !e.metaKey && !e.altKey && document.activeElement !== searchInput) {
                    e.preventDefault();
                    searchInput.focus();
                }
            });

            // Add search examples for testing
            addSearchTestData();
        }

        function addSearchTestData() {
            // Add some popular titles to help with testing
            const testData = [
                {
                    id: 999999,
                    title: 'All of Us Are Dead',
                    name: 'All of Us Are Dead',
                    type: 'tv',
                    overview: 'A high school becomes ground zero for a zombie virus outbreak. Trapped students must fight their way out or turn into one of the rabid infected.',
                    vote_average: 8.5,
                    first_air_date: '2022-01-28',
                    poster_path: '/nHf61UzkfFno5X1ofIhugCPus2R.jpg',
                    genre_ids: [18, 10759, 10765]
                },
                {
                    id: 999998,
                    title: 'Squid Game',
                    name: 'Squid Game',
                    type: 'tv',
                    overview: 'Hundreds of cash-strapped players accept a strange invitation to compete in children\'s games for a tempting prize, but the stakes are deadly.',
                    vote_average: 8.0,
                    first_air_date: '2021-09-17',
                    poster_path: '/dDlEmu3EZCsQQeTSUmRj0kDRMj.jpg',
                    genre_ids: [18, 10759, 9648]
                }
            ];

            // Store test data for search
            window.testSearchData = testData;

            // Add comprehensive test cast/crew data with real TMDB-style paths
            window.testCastData = {
                999999: { // All of Us Are Dead
                    cast: [
                        {
                            name: 'Park Ji-hu',
                            character: 'Nam On-jo',
                            profile_path: '/sJiNBBmL4a1s0hmnoUuLJ5o1t.jpg'
                        },
                        {
                            name: 'Yoon Chan-young',
                            character: 'Lee Cheong-san',
                            profile_path: '/p0KHZ0eVQRGKvnlHHaqK8ujjK.jpg'
                        },
                        {
                            name: 'Cho Yi-hyun',
                            character: 'Choi Nam-ra',
                            profile_path: '/aKzqFNKP2G0YhZq9lGEKwiw.jpg'
                        },
                        {
                            name: 'Lomon',
                            character: 'Lee Su-hyeok',
                            profile_path: '/mVzRUeKxM2wJ5n8oXhH7R.jpg'
                        },
                        {
                            name: 'Yoo In-soo',
                            character: 'Yoon Gwi-nam',
                            profile_path: '/kU1n4EjL.jpg'
                        },
                        {
                            name: 'Lee Yoo-mi',
                            character: 'Lee Na-yeon',
                            profile_path: '/p0KHZ0eVQRGKvnlHHaqK8ujjK.jpg'
                        }
                    ],
                    crew: [
                        {
                            name: 'Lee Jae-kyoo',
                            job: 'Director',
                            profile_path: '/director1.jpg'
                        },
                        {
                            name: 'Kim Nam-su',
                            job: 'Director',
                            profile_path: '/director2.jpg'
                        }
                    ]
                },
                999998: { // Squid Game
                    cast: [
                        {
                            name: 'Lee Jung-jae',
                            character: 'Seong Gi-hun',
                            profile_path: '/lldeG4Co5MSJJpiUkkJjTITPc5.jpg'
                        },
                        {
                            name: 'Park Hae-soo',
                            character: 'Cho Sang-woo',
                            profile_path: '/p0KHZ0eVQRGKvnlHHaqK8ujjK.jpg'
                        },
                        {
                            name: 'Wi Ha-jun',
                            character: 'Hwang Jun-ho',
                            profile_path: '/mVzRUeKxM2wJ5n8oXhH7R.jpg'
                        },
                        {
                            name: 'HoYeon Jung',
                            character: 'Kang Sae-byeok',
                            profile_path: '/kU1n4EjL.jpg'
                        },
                        {
                            name: 'O Yeong-su',
                            character: 'Oh Il-nam',
                            profile_path: '/p0KHZ0eVQRGKvnlHHaqK8ujjK.jpg'
                        },
                        {
                            name: 'Heo Sung-tae',
                            character: 'Jang Deok-su',
                            profile_path: '/aKzqFNKP2G0YhZq9lGEKwiw.jpg'
                        }
                    ],
                    crew: [
                        {
                            name: 'Hwang Dong-hyuk',
                            job: 'Director',
                            profile_path: '/director2.jpg'
                        }
                    ]
                }
            };
        }

        // Set up event listeners
        function setupEventListeners() {
            searchBtn.addEventListener('click', handleSearch);
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.trim();

                // Show results immediately for every keystroke if query length > 0
                if (query.length > 0) {
                    showLiveSearchResults(query);
                } else {
                    hideLiveSearchResults();
                    hideSearchSuggestions();
                    // Show default content when search is cleared
                    currentQuery = '';
                    currentPage = 1;
                    contentGrid.innerHTML = '';
                    fetchContent();
                }
            });

            searchInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    handleSearch();
                }
            });

            // Hide live results when clicking outside
            searchInput.addEventListener('blur', () => {
                setTimeout(() => {
                    hideLiveSearchResults();
                    hideSearchSuggestions();
                }, 200);
            });

            searchInput.addEventListener('focus', () => {
                const query = searchInput.value.trim();
                if (query.length > 0) {
                    showLiveSearchResults(query);
                }
            });

            movieModeBtn.addEventListener('click', () => switchMode('movie'));
            tvModeBtn.addEventListener('click', () => switchMode('tv'));

            loadMoreBtn.addEventListener('click', loadMore);
            closeModal.addEventListener('click', () => detailModal.style.display = 'none');

            // Close modals when clicking outside
            detailModal.addEventListener('click', (e) => {
                if (e.target === detailModal) {
                    detailModal.style.display = 'none';
                }
            });

            trailerModal.addEventListener('click', (e) => {
                if (e.target === trailerModal) {
                    trailerModal.style.display = 'none';
                    trailerVideo.src = '';
                }
            });

            closeTrailer.addEventListener('click', () => {
                trailerModal.style.display = 'none';
                trailerVideo.src = '';
            });

            // Watch button in modal
            watchBtn.addEventListener('click', () => {
                playVideo(currentItem);
            });
        }

        // Handle search
        function handleSearch() {
            const query = searchInput.value.trim();
            if (query) {
                currentQuery = query;
                currentPage = 1;
                hideLiveSearchResults();
                hideSearchSuggestions();
                // Replace main content with search results
                performFullSearch(query);
            }
        }

        async function performFullSearch(query) {
            showSearchLoading(true);

            try {
                // First try to get results from popular content
                let allItems = await fetchAllContentForSearch();

                // If we don't have enough results or the specific movie isn't found,
                // try direct TMDB search
                if (allItems.length < 50 || !containsMatchingTitle(allItems, query)) {
                    const directResults = await directTMDBSearch(query);
                    if (directResults.length > 0) {
                        allItems = [...directResults, ...allItems];
                    }
                }

                const searchResults = allItems.map(item => {
                    const score = calculateRelevanceScore(item, query);
                    return { item, score };
                }).filter(result => result.score > 0)
                  .sort((a, b) => b.score - a.score)
                  .slice(0, 20) // Show more results in full search
                  .map(result => result.item);

                displayContent(searchResults);
                updateSearchResultsCounter(searchResults.length);
                showSearchLoading(false);
            } catch (error) {
                console.error('Error in full search:', error);
                showSearchLoading(false);
            }
        }

        function containsMatchingTitle(items, query) {
            const queryLower = query.toLowerCase();
            return items.some(item => {
                const title = (item.title || item.name || '').toLowerCase();
                const originalTitle = (item.original_title || item.original_name || '').toLowerCase();
                return title.includes(queryLower) || originalTitle.includes(queryLower);
            });
        }

        async function directTMDBSearch(query) {
            const results = [];

            try {
                const [movieResponse, tvResponse] = await Promise.all([
                    fetch(`${API_URL}/search/movie?query=${encodeURIComponent(query)}&page=1`),
                    fetch(`${API_URL}/search/tv?query=${encodeURIComponent(query)}&page=1`)
                ]);

                const [movieData, tvData] = await Promise.all([
                    movieResponse.json(),
                    tvResponse.json()
                ]);

                // Add type to items
                const movies = movieData.results.map(item => ({ ...item, type: 'movie' }));
                const tvShows = tvData.results.map(item => ({ ...item, type: 'tv' }));

                results.push(...movies, ...tvShows);

                console.log(`Direct search found ${results.length} results for "${query}"`);

            } catch (error) {
                console.error('Error in direct TMDB search:', error);
            }

            return results;
        }

        // Enhanced search with fuzzy matching and relevance scoring
        function performAdvancedSearch(query) {
            const searchTerm = query.toLowerCase().trim();

            if (!searchTerm) {
                fetchContent();
                hideSearchSuggestions();
                return;
            }

            showSearchLoading(true);

            // Use requestAnimationFrame for better performance
            requestAnimationFrame(async () => {
                try {
                    const allItems = await fetchAllContentForSearch();
                    const searchResults = allItems.map(item => {
                        const score = calculateRelevanceScore(item, searchTerm);
                        return { item, score };
                    }).filter(result => result.score > 0)
                      .sort((a, b) => b.score - a.score)
                      .slice(0, 50)
                      .map(result => result.item);

                    displayContent(searchResults);
                    showSearchSuggestions(searchTerm, allItems);
                    showSearchLoading(false);
                    updateSearchResultsCounter(searchResults.length);
                } catch (error) {
                    console.error('Error in advanced search:', error);
                    showSearchLoading(false);
                }
            });
        }

        async function fetchAllContentForSearch() {
            const allItems = [];

            try {
                // Fetch more pages for better search coverage
                const pagesToFetch = 3; // Fetch first 3 pages for more results
                const fetchPromises = [];

                // Fetch multiple pages of movies and TV shows
                for (let page = 1; page <= pagesToFetch; page++) {
                    fetchPromises.push(
                        fetch(`${API_URL}/movie/popular?page=${page}`).then(res => res.json()),
                        fetch(`${API_URL}/tv/popular?page=${page}`).then(res => res.json())
                    );
                }

                const responses = await Promise.all(fetchPromises);

                // Process all responses
                for (let i = 0; i < responses.length; i += 2) {
                    const movieData = responses[i];
                    const tvData = responses[i + 1];

                    // Add type to items for easier identification
                    const movies = movieData.results.map(item => ({ ...item, type: 'movie' }));
                    const tvShows = tvData.results.map(item => ({ ...item, type: 'tv' }));

                    allItems.push(...movies, ...tvShows);
                }

                // Remove duplicates based on ID
                const uniqueItems = allItems.filter((item, index, self) =>
                    index === self.findIndex(t => t.id === item.id)
                );

                // Add test data for popular titles that might not be in the API
                if (window.testSearchData) {
                    uniqueItems.push(...window.testSearchData);
                }

                console.log(`Loaded ${uniqueItems.length} items for search`);
                return uniqueItems;

            } catch (error) {
                console.error('Error fetching content for search:', error);

                // Fallback: try to search TMDB directly for the specific query
                return await fallbackSearch();
            }
        }

        async function fallbackSearch() {
            const allItems = [];

            try {
                // If main search fails, try direct TMDB search
                const searchQuery = searchInput.value.trim();
                if (searchQuery.length >= 3) {
                    const [movieResponse, tvResponse] = await Promise.all([
                        fetch(`${API_URL}/search/movie?query=${encodeURIComponent(searchQuery)}&page=1`),
                        fetch(`${API_URL}/search/tv?query=${encodeURIComponent(searchQuery)}&page=1`)
                    ]);

                    const [movieData, tvData] = await Promise.all([
                        movieResponse.json(),
                        tvResponse.json()
                    ]);

                    const movies = movieData.results.map(item => ({ ...item, type: 'movie' }));
                    const tvShows = tvData.results.map(item => ({ ...item, type: 'tv' }));

                    allItems.push(...movies, ...tvShows);
                }
            } catch (error) {
                console.error('Fallback search also failed:', error);
            }

            return allItems;
        }

        function calculateRelevanceScore(item, searchTerm) {
            let score = 0;
            const terms = searchTerm.split(' ').filter(term => term.length > 0);

            // Search in multiple fields with different weights
            const title = (item.title || item.name || '').toLowerCase();
            const overview = (item.overview || '').toLowerCase();
            const originalTitle = (item.original_title || item.original_name || '').toLowerCase();

            terms.forEach(term => {
                // Exact title match gets highest score (including original titles)
                if (title === term) score += 1000;
                else if (originalTitle === term) score += 1000;
                else if (title.includes(term) && title.indexOf(term) === 0) score += 800; // Starts with term
                else if (title.includes(term)) score += 200;
                else if (originalTitle.includes(term)) score += 200;

                // Overview matches
                if (overview.includes(term)) score += 50;

                // More flexible partial matching for each word
                const titleWords = title.split(' ');
                const originalTitleWords = originalTitle.split(' ');
                const allWords = [...titleWords, ...originalTitleWords];

                allWords.forEach(word => {
                    if (word.length >= 2 && term.length >= 2) {
                        // Exact word match
                        if (word === term) score += 400;
                        // Word starts with search term
                        else if (word.startsWith(term)) score += 200;
                        // Word contains search term
                        else if (word.includes(term)) score += 100;
                        // Search term contains word (reverse matching)
                        else if (term.includes(word)) score += 80;
                        // Character-by-character fuzzy matching
                        else {
                            const similarity = calculateSimilarity(word, term);
                            if (similarity > 0.6) score += Math.floor(similarity * 150);
                        }
                    }
                });

                // Special handling for Korean/Asian titles
                if (containsAsianCharacters(term)) {
                    // For Asian titles, be more lenient with matching
                    if (title.includes(term) || originalTitle.includes(term)) {
                        score += 300;
                    }
                }

                // Fuzzy character matching (more lenient)
                const fuzzyMatches = fuzzyMatch(title, term) + fuzzyMatch(originalTitle, term) + fuzzyMatch(overview, term) * 0.5;
                score += fuzzyMatches * 25;

                // Even more flexible matching for short terms
                if (term.length >= 2) {
                    const shortFuzzyMatches = shortFuzzyMatch(title, term) + shortFuzzyMatch(originalTitle, term) + shortFuzzyMatch(overview, term) * 0.3;
                    score += shortFuzzyMatches * 20;
                }
            });

            return score;
        }

        function calculateSimilarity(str1, str2) {
            if (str1 === str2) return 1;

            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;

            if (longer.length === 0) return 0;

            const editDistance = levenshteinDistance(longer, shorter);
            return (longer.length - editDistance) / longer.length;
        }

        function levenshteinDistance(str1, str2) {
            const matrix = [];

            for (let i = 0; i <= str2.length; i++) {
                matrix[i] = [i];
            }

            for (let j = 0; j <= str1.length; j++) {
                matrix[0][j] = j;
            }

            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }

            return matrix[str2.length][str1.length];
        }

        function containsAsianCharacters(text) {
            // Check if text contains Korean, Japanese, or Chinese characters
            const asianCharRegex = /[\u1100-\u11FF\u3130-\u318F\uAC00-\uD7AF\u4E00-\u9FFF\u3040-\u309F\u30A0-\u30FF]/;
            return asianCharRegex.test(text);
        }

        function shortFuzzyMatch(text, pattern) {
            if (!text || !pattern || pattern.length < 2) return 0;

            const textLower = text.toLowerCase();
            const patternLower = pattern.toLowerCase();

            // Check if all characters of pattern exist in text in order
            let textIndex = 0;
            let patternIndex = 0;

            while (textIndex < textLower.length && patternIndex < patternLower.length) {
                if (textLower[textIndex] === patternLower[patternIndex]) {
                    patternIndex++;
                }
                textIndex++;
            }

            // Return score based on how much of the pattern was matched
            return patternIndex / patternLower.length;
        }

        function fuzzyMatch(text, pattern) {
            if (!text || !pattern) return 0;

            const textLower = text.toLowerCase();
            const patternLower = pattern.toLowerCase();

            // Exact match
            if (textLower === patternLower) return 3;

            // Starts with
            if (textLower.startsWith(patternLower)) return 2;

            // Contains
            if (textLower.includes(patternLower)) return 1;

            // Fuzzy character matching
            let score = 0;
            let patternIndex = 0;

            for (let i = 0; i < textLower.length && patternIndex < patternLower.length; i++) {
                if (textLower[i] === patternLower[patternIndex]) {
                    score++;
                    patternIndex++;
                }
            }

            return patternIndex === patternLower.length ? score / patternLower.length : 0;
        }

        function showLiveSearchResults(query) {
            if (query.length < 2) {
                hideLiveSearchResults();
                return;
            }

            // Show loading state
            showSearchLoading(true);

            // Use requestAnimationFrame for smooth updates
            requestAnimationFrame(async () => {
                try {
                    const allItems = await fetchAllContentForSearch();
                    const searchResults = allItems.map(item => {
                        const score = calculateRelevanceScore(item, query);
                        return { item, score };
                    }).filter(result => result.score > 0)
                      .sort((a, b) => b.score - a.score)
                      .slice(0, 8) // Show top 8 results
                      .map(result => result.item);

                    displayLiveSearchResults(searchResults, query);
                    showSearchLoading(false);
                } catch (error) {
                    console.error('Error in live search:', error);
                    showSearchLoading(false);
                }
            });
        }

        function displayLiveSearchResults(results, query) {
            let resultsContainer = document.getElementById('liveSearchResults');

            if (!resultsContainer) {
                resultsContainer = document.createElement('div');
                resultsContainer.id = 'liveSearchResults';
                resultsContainer.className = 'live-search-results';
                resultsContainer.style.cssText = `
                    position: absolute;
                    top: 100%;
                    left: 0;
                    right: 0;
                    background: var(--dark);
                    border: 2px solid var(--primary);
                    border-top: none;
                    border-radius: 0 0 15px 15px;
                    max-height: 500px;
                    overflow-y: auto;
                    z-index: 1000;
                    display: none;
                    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
                `;
                document.querySelector('.search-container').appendChild(resultsContainer);
            }

            if (results.length > 0) {
                resultsContainer.innerHTML = `
                    <div class="live-results-header" style="padding: 15px; border-bottom: 1px solid rgba(0,255,157,0.2); color: var(--primary); font-weight: bold;">
                        <i class="fas fa-search"></i> Search Results (${results.length})
                    </div>
                    <div class="live-results-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; padding: 15px;">
                        ${results.map(item => createLiveResultCard(item, query)).join('')}
                    </div>
                `;
                resultsContainer.style.display = 'block';
            } else {
                resultsContainer.innerHTML = `
                    <div class="no-live-results" style="padding: 30px; text-align: center; color: #ccc;">
                        <i class="fas fa-search" style="font-size: 32px; color: var(--primary); margin-bottom: 15px;"></i>
                        <p>No results found for "${query}"</p>
                        <small>Try different keywords or check spelling</small>
                    </div>
                `;
                resultsContainer.style.display = 'block';
            }
        }

        function createLiveResultCard(item, query) {
            const title = item.title || item.name || 'Untitled';
            const year = (item.release_date || item.first_air_date || '').split('-')[0];
            const posterPath = item.poster_path ? `${IMG_URL}${item.poster_path}` : 'https://via.placeholder.com/300x450/1a1a2e/00FF9D?text=No+Image';
            const type = item.type === 'movie' ? 'Movie' : 'TV Show';
            const rating = item.vote_average ? item.vote_average.toFixed(1) : 'N/A';

            return `
                <div class="live-result-card" style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 10px; cursor: pointer; transition: all 0.2s; display: flex; gap: 12px;"
                     onclick="selectLiveResult('${item.type}', ${item.id})">
                    <div class="live-result-poster" style="flex-shrink: 0;">
                        <img src="${posterPath}" alt="${title}" style="width: 60px; height: 90px; object-fit: cover; border-radius: 5px;">
                    </div>
                    <div class="live-result-info" style="flex: 1; min-width: 0;">
                        <h4 style="color: var(--primary); font-size: 0.9rem; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                            ${highlightSearchTerm(title, query)}
                        </h4>
                        <div style="display: flex; gap: 8px; margin-bottom: 5px;">
                            <span style="background: rgba(0,255,157,0.2); color: var(--primary); padding: 2px 6px; border-radius: 8px; font-size: 0.7rem;">${year}</span>
                            <span style="background: rgba(255,46,99,0.2); color: var(--accent); padding: 2px 6px; border-radius: 8px; font-size: 0.7rem;">${type}</span>
                        </div>
                        <div style="color: #ffd700; font-size: 0.8rem;">
                            <i class="fas fa-star"></i> ${rating}
                        </div>
                        ${item.overview ? `<p style="color: #ccc; font-size: 0.75rem; margin-top: 5px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${highlightSearchTerm(item.overview.substring(0, 80), query)}...</p>` : ''}
                    </div>
                </div>
            `;
        }

        function selectLiveResult(type, id) {
            currentMode = type;
            showDetails(id);
            hideLiveSearchResults();
            hideSearchSuggestions();
        }

        function hideLiveSearchResults() {
            const container = document.getElementById('liveSearchResults');
            if (container) {
                container.style.display = 'none';
            }
        }

        function showSearchSuggestions(searchTerm, allItems) {
            const suggestions = generateSearchSuggestions(searchTerm, allItems);
            let suggestionsContainer = document.getElementById('searchSuggestions');

            if (!suggestionsContainer) {
                suggestionsContainer = document.createElement('div');
                suggestionsContainer.id = 'searchSuggestions';
                suggestionsContainer.className = 'search-suggestions';
                suggestionsContainer.style.cssText = `
                    position: absolute;
                    top: 100%;
                    left: 0;
                    right: 0;
                    background: var(--dark);
                    border: 2px solid var(--primary);
                    border-top: none;
                    border-radius: 0 0 15px 15px;
                    max-height: 250px;
                    overflow-y: auto;
                    z-index: 1000;
                    display: none;
                    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
                `;
                document.querySelector('.search-container').appendChild(suggestionsContainer);
            }

            if (suggestions.length > 0) {
                suggestionsContainer.innerHTML = suggestions.map(suggestion => `
                    <div class="search-suggestion" onclick="selectSuggestion('${suggestion.replace(/'/g, "\\'")}')">
                        <i class="fas fa-search"></i> ${highlightSearchTerm(suggestion, searchTerm)}
                    </div>
                `).join('');
                suggestionsContainer.style.display = 'block';
            } else {
                suggestionsContainer.style.display = 'none';
            }
        }

        function hideSearchSuggestions() {
            const container = document.getElementById('searchSuggestions');
            if (container) {
                container.style.display = 'none';
            }
        }

        function generateSearchSuggestions(searchTerm, allItems) {
            const suggestions = new Set();
            const searchLower = searchTerm.toLowerCase();

            // Get suggestions from titles
            allItems.forEach(item => {
                const title = item.title || item.name || '';
                if (title.toLowerCase().includes(searchLower)) {
                    // Add partial matches as suggestions
                    const words = title.split(' ');
                    words.forEach(word => {
                        if (word.toLowerCase().startsWith(searchLower) && word.length > searchLower.length) {
                            suggestions.add(word);
                        }
                    });
                }
            });

            return Array.from(suggestions).slice(0, 8);
        }

        function selectSuggestion(suggestion) {
            searchInput.value = suggestion;
            performAdvancedSearch(suggestion);
            hideSearchSuggestions();
        }

        function highlightSearchTerm(text, searchTerm) {
            if (!searchTerm) return text;

            const regex = new RegExp(`(${searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            return text.replace(regex, '<mark>$1</mark>');
        }

        function showSearchLoading(show) {
            let loadingIndicator = document.getElementById('searchLoading');

            if (show && !loadingIndicator) {
                loadingIndicator = document.createElement('div');
                loadingIndicator.id = 'searchLoading';
                loadingIndicator.className = 'search-loading';
                loadingIndicator.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Searching...';
                loadingIndicator.style.cssText = `
                    position: absolute;
                    top: 50%;
                    right: 120px;
                    transform: translateY(-50%);
                    color: var(--primary);
                    font-size: 14px;
                    z-index: 1000;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                `;
                document.querySelector('.search-container').appendChild(loadingIndicator);
            } else if (!show && loadingIndicator) {
                loadingIndicator.remove();
            }
        }

        function updateSearchResultsCounter(resultCount) {
            let counter = document.getElementById('searchResultsCounter');

            if (!counter) {
                counter = document.createElement('div');
                counter.id = 'searchResultsCounter';
                counter.className = 'search-results-counter';
                document.querySelector('.container').insertBefore(counter, document.querySelector('.content-grid'));
            }

            if (currentQuery) {
                const itemText = resultCount === 1 ? 'result' : 'results';
                counter.innerHTML = `
                    <div style="background: var(--dark); padding: 15px 25px; margin-bottom: 25px; border-radius: 10px; border-left: 4px solid var(--primary); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);">
                        <i class="fas fa-search" style="color: var(--primary); margin-right: 10px;"></i>
                        Found <strong>${resultCount}</strong> ${itemText}
                        for <strong>"${currentQuery}"</strong>
                    </div>
                `;
                counter.style.display = 'block';
            } else {
                counter.style.display = 'none';
            }
        }

        // Switch between movie and TV mode
        function switchMode(mode) {
            currentMode = mode;
            currentPage = 1;
            contentGrid.innerHTML = '';

            // Update active button
            movieModeBtn.classList.toggle('active', mode === 'movie');
            tvModeBtn.classList.toggle('active', mode === 'tv');

            fetchContent();
        }

        // Fetch content from TMDB API
        async function fetchContent() {
            if (isFetching) return;
            isFetching = true;

            loadingElement.style.display = 'block';
            loadMoreBtn.style.display = 'none';

            try {
                let endpoint;
                if (currentQuery) {
                    endpoint = currentMode === 'movie'
                        ? `${API_URL}/search/movie?query=${currentQuery}&page=${currentPage}`
                        : `${API_URL}/search/tv?query=${currentQuery}&page=${currentPage}`;
                } else {
                    endpoint = currentMode === 'movie'
                        ? `${API_URL}/movie/popular?page=${currentPage}`
                        : `${API_URL}/tv/popular?page=${currentPage}`;
                }

                const response = await fetch(endpoint);
                const data = await response.json();

                displayContent(data.results);

                // Show load more button if there are more pages
                if (data.page < data.total_pages) {
                    loadMoreBtn.style.display = 'block';
                }
            } catch (error) {
                console.error('Error fetching content:', error);
                contentGrid.innerHTML = '<p>Error loading content. Please try again later.</p>';
            } finally {
                isFetching = false;
                loadingElement.style.display = 'none';
            }
        }

        // Fetch hero movies
        async function fetchHeroMovies() {
            try {
                const response = await fetch(`${API_URL}/movie/popular?page=1`);
                const data = await response.json();
                heroMovies = data.results.slice(0, 10);
                updateHero();
            } catch (error) {
                console.error('Error fetching hero movies:', error);
            }
        }

        // Update hero section
        function updateHero() {
            if (heroMovies.length === 0) return;
            const movie = heroMovies[currentHeroIndex];
            const title = movie.title;
            const overview = movie.overview;
            const backdropPath = movie.backdrop_path;
            const backdrop = backdropPath ? `https://image.tmdb.org/t/p/original${backdropPath}` : 'https://image.tmdb.org/t/p/original/8rpDcsfLJypbO6vREc0547VKqEv.jpg';
            document.getElementById('heroTitle').textContent = title;
            document.getElementById('heroDesc').textContent = overview ? overview.substring(0, 200) + '...' : 'No description available.';
            document.querySelector('.hero').style.backgroundImage = `linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('${backdrop}')`;
            currentHeroIndex = (currentHeroIndex + 1) % heroMovies.length;
        }

        // Display content in the grid
        function displayContent(items) {
            if (items.length === 0) {
                const searchTerm = searchInput.value.trim();
                contentGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: #ccc;">
                        <i class="fas fa-search" style="font-size: 64px; color: var(--primary); margin-bottom: 30px;"></i>
                        <h3 style="font-size: 1.5rem; margin-bottom: 15px;">No results found</h3>
                        <p style="font-size: 1.1rem; margin-bottom: 20px;">
                            ${searchTerm ? `Try searching for something else or check your spelling.` : 'No content available at the moment.'}
                        </p>
                        ${searchTerm ? `<p style="color: var(--primary);"><strong>Searched for:</strong> "${searchTerm}"</p>` : ''}
                    </div>
                `;
                return;
            }

            items.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'content-card';

                const title = currentMode === 'movie' ? item.title : item.name;
                const date = currentMode === 'movie' ? item.release_date : item.first_air_date;
                const posterPath = item.poster_path ? `${IMG_URL}${item.poster_path}` : 'https://via.placeholder.com/300x450/1a1a2e/00FF9D?text=No+Image';

                // Get current search term for highlighting
                const searchTerm = searchInput.value.trim();
                const highlightedTitle = highlightSearchTerm(title, searchTerm);

                // Enhanced card with better metadata
                const year = date ? new Date(date).getFullYear() : 'N/A';
                const rating = item.vote_average ? item.vote_average.toFixed(1) : 'N/A';
                const type = currentMode === 'movie' ? 'Movie' : 'TV Show';

                card.innerHTML = `
                    <img src="${posterPath}" alt="${title}" class="card-img">
                    <div class="card-content">
                        <h3 class="card-title">${highlightedTitle}</h3>
                        <div class="card-info">
                            <span class="year-badge">${year}</span>
                            <span class="rating-badge"><i class="fas fa-star"></i> ${rating}</span>
                            <span class="type-badge">${type}</span>
                        </div>
                        ${item.overview ? `<p class="card-overview">${truncateText(highlightSearchTerm(item.overview, searchTerm), 120)}</p>` : ''}
                        <div class="card-cast" id="cast-${item.id}" style="margin-top: 10px; min-height: 40px;">
                            <div class="cast-loading" style="display: flex; align-items: center; gap: 8px; color: #999; font-size: 0.75rem;">
                                <i class="fas fa-spinner fa-spin"></i>
                                <span>Loading cast & crew...</span>
                            </div>
                        </div>
                        <button class="watch-btn-card" data-item-id="${item.id}">
                            <i class="fas fa-play"></i> Watch Now
                        </button>
                    </div>
                `;

                // Load cast information for this item (with slight delay to prevent overwhelming the API)
                setTimeout(() => {
                    loadCastInfo(item.id, item.type || currentMode);
                }, index * 100); // Stagger the requests

                // Add event listener for watch button
                const watchBtnCard = card.querySelector('.watch-btn-card');
                watchBtnCard.addEventListener('click', (e) => {
                    e.stopPropagation();
                    playVideo(item);
                });

                card.addEventListener('click', () => {
                    showDetails(item.id);
                });

                contentGrid.appendChild(card);
            });
        }

        // Load cast information for a movie/TV show
        async function loadCastInfo(itemId, type) {
            try {
                console.log(`Loading cast info for ${type} ID: ${itemId}`);

                // Check if we have test data for this item
                if (window.testCastData && window.testCastData[itemId]) {
                    console.log('Using test cast data for ID:', itemId);
                    displayCastInfo(itemId, window.testCastData[itemId]);
                    return;
                }

                const endpoint = `${API_URL}/${type}/${itemId}/credits`;
                const response = await fetch(endpoint);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('Cast data received:', data);

                displayCastInfo(itemId, data);

            } catch (error) {
                console.error('Error loading cast info:', error);

                // Try to use test data as fallback
                if (window.testCastData && window.testCastData[itemId]) {
                    console.log('Using test cast data as fallback');
                    displayCastInfo(itemId, window.testCastData[itemId]);
                    return;
                }

                const castContainer = document.getElementById(`cast-${itemId}`);
                if (castContainer) {
                    castContainer.innerHTML = '<small style="color: #999; font-size: 0.7rem;">Cast info not available</small>';
                }
            }
        }

        function displayCastInfo(itemId, data) {
            const castContainer = document.getElementById(`cast-${itemId}`);
            if (!castContainer) {
                console.log('Cast container not found for ID:', itemId);
                return;
            }

            console.log('Displaying cast info for item:', itemId, 'Data:', data);

            if (data.cast && data.cast.length > 0) {
                const topCast = data.cast.slice(0, 3); // Show top 3 cast members
                const director = data.crew ? data.crew.find(person => person.job === 'Director') : null;

                console.log('Director found:', director);
                console.log('Top cast:', topCast);

                castContainer.innerHTML = `
                    <div class="cast-info" style="margin-top: 8px; padding: 8px 0; border-top: 1px solid rgba(0,255,157,0.1);">
                        ${director ? `<div class="director-info" style="margin-bottom: 8px;">
                            <small style="color: var(--primary); font-weight: bold; display: flex; align-items: center; gap: 5px;">
                                <i class="fas fa-user-tie"></i> Director: ${director.name}
                            </small>
                        </div>` : ''}
                        <div class="cast-members" style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                            <small style="color: #999; font-weight: bold; display: flex; align-items: center; gap: 5px;">
                                <i class="fas fa-users"></i> Cast:
                            </small>
                            ${topCast.map((actor, index) => `
                                <div class="cast-member" style="display: flex; align-items: center; gap: 5px; ${index > 0 ? 'margin-left: 5px;' : ''}">
                                    <img src="${actor.profile_path ? `https://image.tmdb.org/t/p/w185${actor.profile_path}` : 'https://via.placeholder.com/30x30/1a1a2e/00FF9D?text=ðŸ‘¤'}"
                                         alt="${actor.name}"
                                         style="width: 25px; height: 25px; border-radius: 50%; object-fit: cover; border: 1px solid var(--primary);"
                                         onerror="this.src='https://via.placeholder.com/30x30/1a1a2e/00FF9D?text=ðŸ‘¤'; this.onerror=null;"
                                         loading="lazy">
                                    <small style="color: #ccc; font-size: 0.7rem; white-space: nowrap;">${truncateText(actor.name, 12)}</small>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;

                console.log('Cast info displayed successfully for item:', itemId);
            } else {
                castContainer.innerHTML = '<small style="color: #999; font-size: 0.7rem; padding: 8px 0; border-top: 1px solid rgba(0,255,157,0.1);">Cast info not available</small>';
            }
        }

        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        // Load more content
        function loadMore() {
            currentPage++;
            fetchContent();
        }

        // Show details in modal
        async function showDetails(itemId) {
            try {
                const endpoint = `${API_URL}/${currentMode}/${itemId}`;
                const response = await fetch(endpoint);
                if (!response.ok) throw new Error('Failed to fetch details.');
                const item = await response.json();

                currentItem = item;

                const title = currentMode === 'movie' ? item.title : item.name;
                const date = currentMode === 'movie' ? item.release_date : item.first_air_date;
                const posterPath = item.poster_path ? `https://image.tmdb.org/t/p/w780${item.poster_path}` : 'https://via.placeholder.com/780x1170/1a1a2e/00FF9D?text=No+Image';

                modalTitle.textContent = title;
                modalPoster.src = posterPath;
                modalDate.textContent = date || 'N/A';
                modalRating.textContent = item.vote_average ? `${item.vote_average.toFixed(1)}/10` : 'N/A';
                modalLanguage.textContent = item.original_language ? item.original_language.toUpperCase() : 'N/A';
                modalOverview.textContent = item.overview || 'No overview available.';

                if (currentMode === 'movie') {
                    modalRuntime.textContent = item.runtime ? `${item.runtime} min` : 'N/A';
                } else {
                    modalRuntime.textContent = item.episode_run_time && item.episode_run_time.length > 0 ? `${item.episode_run_time[0]} min` : 'N/A';
                }

                modalGenres.textContent = item.genres ? item.genres.map(g => g.name).join(', ') : 'N/A';

                // Load cast and crew information
                loadCastAndCrew(itemId, currentMode);

                detailModal.style.display = 'block';
            } catch (error) {
                console.error('Error showing details:', error);
                alert('Could not load details for this item. Please try again.');
            }
        }

        // Load cast and crew information
        async function loadCastAndCrew(itemId, type) {
            try {
                console.log(`Loading cast and crew for ${type} ID: ${itemId}`);

                // Check if we have test data for this item
                if (window.testCastData && window.testCastData[itemId]) {
                    console.log('Using test cast data for modal');
                    updateModalWithCast(window.testCastData[itemId]);
                    return;
                }

                const endpoint = `${API_URL}/${type}/${itemId}/credits`;
                const response = await fetch(endpoint);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('Cast and crew data received:', data);

                // Update modal with cast and crew info
                updateModalWithCast(data);

            } catch (error) {
                console.error('Error loading cast and crew:', error);

                // Try to use test data as fallback
                if (window.testCastData && window.testCastData[itemId]) {
                    console.log('Using test cast data as fallback for modal');
                    updateModalWithCast(window.testCastData[itemId]);
                    return;
                }

                updateModalWithCast({ cast: [], crew: [] }); // Show empty state
            }
        }

        function updateModalWithCast(creditsData) {
            const modalDetails = document.querySelector('.modal-details');

            // Remove existing cast/crew info
            const existingCastInfo = document.getElementById('modalCastInfo');
            if (existingCastInfo) {
                existingCastInfo.remove();
            }

            // Create cast and crew section
            const castInfoDiv = document.createElement('div');
            castInfoDiv.id = 'modalCastInfo';
            castInfoDiv.className = 'cast-crew-info';

            console.log('Updating modal with cast data:', creditsData);

            if (creditsData.cast && creditsData.cast.length > 0) {
                const director = creditsData.crew ? creditsData.crew.find(person => person.job === 'Director') : null;
                const topCast = creditsData.cast.slice(0, 6); // Show top 6 cast members

                console.log('Director:', director);
                console.log('Top cast:', topCast);

                castInfoDiv.innerHTML = `
                    <div class="director-section" style="margin-bottom: 1.5rem;">
                        <h3 style="color: var(--primary); margin-bottom: 1rem;"><i class="fas fa-user-tie"></i> Director</h3>
                        ${director ? `
                            <div class="director-card" style="display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(0,255,157,0.1); border-radius: 10px;">
                                <img src="https://image.tmdb.org/t/p/w185${director.profile_path || ''}"
                                     alt="${director.name}"
                                     style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary);"
                                     onerror="this.src='https://via.placeholder.com/80x80/1a1a2e/00FF9D?text=ðŸ‘¤'; this.onerror=null;">
                                <div>
                                    <h4 style="color: var(--primary); margin-bottom: 5px;">${director.name}</h4>
                                    <p style="color: #ccc; font-size: 0.9rem;">Director</p>
                                </div>
                            </div>
                        ` : '<p style="color: #999;">Director information not available.</p>'}
                    </div>

                    <div class="cast-section">
                        <h3 style="color: var(--primary); margin-bottom: 1rem;"><i class="fas fa-users"></i> Top Cast</h3>
                        <div class="cast-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
                            ${topCast.map(actor => `
                                <div class="cast-card" style="display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; transition: all 0.3s;">
                                    <img src="https://image.tmdb.org/t/p/w185${actor.profile_path || ''}"
                                         alt="${actor.name}"
                                         style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 1px solid var(--primary); flex-shrink: 0;"
                                         onerror="this.src='https://via.placeholder.com/60x60/1a1a2e/00FF9D?text=ðŸ‘¤'; this.onerror=null;">
                                    <div style="flex: 1; min-width: 0;">
                                        <h5 style="color: var(--text); margin-bottom: 3px; font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${actor.name}</h5>
                                        <p style="color: #999; font-size: 0.8rem;">as ${actor.character || 'Unknown Role'}</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else {
                castInfoDiv.innerHTML = '<p style="color: #999;">Cast information not available.</p>';
            }

            // Insert cast info after the overview
            const watchBtn = modalDetails.querySelector('.watch-btn');
            if (watchBtn) {
                modalDetails.insertBefore(castInfoDiv, watchBtn);
            } else {
                modalDetails.appendChild(castInfoDiv);
            }
        }

        // Play video in modal
        async function playVideo(item) {
            currentItem = item;
            detailModal.style.display = 'none';

            // Create video modal if it doesn't exist
            if (!document.getElementById('videoModal')) {
                const videoModalHTML = `
                    <div class="video-modal" id="videoModal">
                        <div class="video-modal-content">
                            <div class="video-header">
                                <div class="video-title" id="videoTitle">Now Playing</div>
                                <div class="provider-buttons" id="providerButtons">
                                    <button class="provider-btn-small" data-provider="vidsrc">Alpha</button>
                                    <button class="provider-btn-small" data-provider="vidsrc.to">Bravo</button>
                                    <button class="provider-btn-small" data-provider="vidlink">Charlie</button>
                                    <button class="provider-btn-small" data-provider="vidplus.to">Delta</button>
                                    <button class="provider-btn-small" data-provider="vixsrc.to">Echo</button>
                                    <button class="provider-btn-small" data-provider="111movies">Foxtrot</button>
                                    <button class="provider-btn-small" data-provider="autoembed.pro">Golf</button>
                                    <button class="provider-btn-small" data-provider="moviemaze.cc">Hotel</button>
                                    <button class="provider-btn-small" data-provider="videasy">India</button>
                                    <button class="provider-btn-small" data-provider="vidfast">Juliet</button>
                                    <button class="provider-btn-small" data-provider="vidking.net">Kilo</button>
                                    <button class="provider-btn-small" data-provider="vidora.su">Lima</button>
                                </div>
                                <div class="video-quality">HD</div>
                                <button class="close-video" id="closeVideo">&times;</button>
                            </div>
                            <div class="video-player">
                                <div class="video-loading" id="videoLoading">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    <span>Loading stream...</span>
                                </div>
                                <iframe class="stream-iframe" id="streamIframe" allowfullscreen allow="autoplay; encrypted-media; picture-in-picture"
                                    referrerpolicy="strict-origin-when-cross-origin">
                                </iframe>
                                <div class="player-controls" id="playerControls">
                                    <div class="controls-top">
                                        <div class="time-display" id="timeDisplay">0:00 / 0:00</div>
                                    </div>
                                    <div class="controls-bottom">
                                        <div class="progress-container" id="progressContainer">
                                            <div class="progress-bar" id="progressBar"></div>
                                        </div>
                                        <button class="fullscreen-btn" id="fullscreenBtn"><i class="fas fa-expand"></i></button>
                                        <button class="next-episode-btn" id="nextEpisodeBtn"><i class="fas fa-step-forward"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', videoModalHTML);
            }

            // Get elements
            const videoModal = document.getElementById('videoModal');
            const streamIframe = document.getElementById('streamIframe');
            const videoLoading = document.getElementById('videoLoading');
            const closeVideo = document.getElementById('closeVideo');
            const providerButtons = document.getElementById('providerButtons');
            const videoTitle = document.getElementById('videoTitle');

            // Set title
            videoTitle.textContent = currentMode === 'movie' ? item.title : item.name;

            // Provider buttons
            const providerBtns = providerButtons.querySelectorAll('.provider-btn-small');
            let currentProviderIndex = 0;
            let loadTimeout;

            // Function to load provider
            const loadProvider = async (index) => {
                if (index >= providerBtns.length) {
                    alert('All providers failed to load. Please try again later.');
                    return;
                }

                const btn = providerBtns[index];
                const provider = btn.getAttribute('data-provider');

                // Update active button
                providerBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                videoLoading.style.display = 'flex';

                try {
                    // Fetch stream URL from worker
                    const params = new URLSearchParams({
                        provider: provider,
                        type: currentMode,
                        id: currentItem.id
                    });
                    if (currentMode === 'tv') {
                        params.append('s', '1');
                        params.append('e', '1');
                    }
                    const response = await fetch(`${API_URL}/stream/?${params}`);
                    if (!response.ok) throw new Error('Failed to fetch stream URL');
                    const data = await response.json();
                    const url = data.url;

                    streamIframe.src = url;

                    // Clear any existing timeout
                    if (loadTimeout) clearTimeout(loadTimeout);

                    // Set timeout to check if video loads (8 seconds)
                    loadTimeout = setTimeout(() => {
                        console.log(`Provider ${provider} failed to load, trying next...`);
                        loadProvider(index + 1);
                    }, 8000);

                    // Listen for iframe load to clear timeout
                    streamIframe.onload = () => {
                        clearTimeout(loadTimeout);
                        videoLoading.style.display = 'none';
                    };

                } catch (error) {
                    console.error('Error fetching video URL:', error);
                    loadProvider(index + 1);
                }
            };

            // Set up provider button event listeners
            providerBtns.forEach((btn, index) => {
                btn.addEventListener('click', () => {
                    if (loadTimeout) clearTimeout(loadTimeout);
                    currentProviderIndex = index;
                    loadProvider(currentProviderIndex);
                });
            });

            // Set up player controls
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            fullscreenBtn.addEventListener('click', () => {
                const player = document.querySelector('.video-player');
                if (player.requestFullscreen) {
                    player.requestFullscreen();
                } else if (player.webkitRequestFullscreen) {
                    player.webkitRequestFullscreen();
                } else if (player.msRequestFullscreen) {
                    player.msRequestFullscreen();
                }
            });

            // Set up close video event listener
            closeVideo.addEventListener('click', () => {
                stopVideo();
                videoModal.style.display = 'none';
                detailModal.style.display = 'block';
            });

            // Also stop video when pressing ESC key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && videoModal.style.display === 'block') {
                    stopVideo();
                    videoModal.style.display = 'none';
                    detailModal.style.display = 'block';
                }
            });

            // Show the video modal and start loading first provider
            videoModal.style.display = 'block';
            loadProvider(0);
        }

        // Function to stop video and audio
        function stopVideo() {
            const streamIframe = document.getElementById('streamIframe');
            if (streamIframe && streamIframe.parentNode) {
                const newIframe = streamIframe.cloneNode();
                streamIframe.parentNode.replaceChild(newIframe, streamIframe);
            }
            const videoLoading = document.getElementById('videoLoading');
            if (videoLoading) {
                videoLoading.style.display = 'flex';
            }
        }

        // Make functions globally available for onclick handlers
        window.selectSuggestion = selectSuggestion;
        window.performAdvancedSearch = performAdvancedSearch;
        window.hideSearchSuggestions = hideSearchSuggestions;
        window.selectLiveResult = selectLiveResult;
        window.showLiveSearchResults = showLiveSearchResults;
        window.hideLiveSearchResults = hideLiveSearchResults;
        window.filterByGenre = filterByGenre;
        window.filterByYear = filterByYear;

        // Add trending category click handlers and ensure all categories work
        function attachCategoryEventListeners() {
            // Attach movie category listeners
            const movieCategories = document.querySelectorAll('#movieCategories .category-item');
            movieCategories.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const genreId = this.getAttribute('data-genre-id');
                    const genreType = this.getAttribute('data-genre-type');
                    const genreText = this.querySelector('span').textContent;
                    console.log('Movie category clicked:', genreText, 'ID:', genreId);
                    filterByGenre(parseInt(genreId), genreType);
                });
            });

            // Attach TV category listeners
            const tvCategories = document.querySelectorAll('#tvCategories .category-item');
            tvCategories.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const genreId = this.getAttribute('data-genre-id');
                    const genreType = this.getAttribute('data-genre-type');
                    const genreText = this.querySelector('span').textContent;
                    console.log('TV category clicked:', genreText, 'ID:', genreId);
                    filterByGenre(parseInt(genreId), genreType);
                });
            });

            // Attach year category listeners
            const yearCategories = document.querySelectorAll('#yearCategories .year-item');
            yearCategories.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const year = this.getAttribute('data-year');
                    console.log('Year category clicked:', year);
                    filterByYear(year);
                });
            });

            // Attach trending category listeners
            const trendingItems = document.querySelectorAll('.trending-item');
            trendingItems.forEach(item => {
                item.addEventListener('click', handleTrendingClick);
            });

            console.log('Category event listeners attached:', {
                movieCategories: movieCategories.length,
                tvCategories: tvCategories.length,
                yearCategories: yearCategories.length,
                trendingItems: trendingItems.length
            });
        }

        // Call this after categories are loaded
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                attachCategoryEventListeners();
            }, 1500);
        });

        function handleTrendingClick(e) {
            e.preventDefault();
            e.stopPropagation();

            const text = e.target.textContent.trim();
            console.log('Trending clicked:', text);

            const searchInput = document.getElementById('searchInput');

            if (searchInput) {
                searchInput.value = text;
                performFullSearch(text);
                hideLiveSearchResults();
                hideSearchSuggestions();
            }
        }
    </script>
</body>
</html>
